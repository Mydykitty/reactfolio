===== README.md =====
# ä¸ªäººç®€å†ç½‘ç«™ - React + TypeScript + TailwindCSS

![é¡¹ç›®æˆªå›¾](./screenshot.png)

<div align="center">
  
  [![Vercel](https://img.shields.io/badge/åœ¨çº¿é¢„è§ˆ-000000?style=for-the-badge&logo=vercel&logoColor=white)](https://reactfolio-sooty.vercel.app/)
  [![GitHub](https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/Mydykitty/reactfolio)

</div>

## âœ¨ åœ¨çº¿ä½“éªŒ

ğŸ‘‰ **[ç‚¹å‡»æŸ¥çœ‹åœ¨çº¿ Demo](https://reactfolio-sooty.vercel.app/)**

## ğŸ¯ é¡¹ç›®äº®ç‚¹

- âš¡ **Vite + React** - æé€Ÿå¼€å‘ä½“éªŒ
- ğŸ“˜ **TypeScript** - ç±»å‹å®‰å…¨ï¼Œå‡å°‘bug
- ğŸŒ“ **æ·±è‰²æ¨¡å¼** - æ”¯æŒç³»ç»Ÿä¸»é¢˜è·Ÿéšï¼Œæ‰‹åŠ¨åˆ‡æ¢
- ğŸ“± **å“åº”å¼è®¾è®¡** - æ‰‹æœº/å¹³æ¿/æ¡Œé¢å®Œç¾é€‚é…
- ğŸ¨ **TailwindCSS** - åŸå­åŒ–CSSï¼Œå¼€å‘æ•ˆç‡++

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: React 18
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: TailwindCSS
- **æ„å»ºå·¥å…·**: Vite
- **ä»£ç è§„èŒƒ**: ESLint + Prettier

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Mydykitty/reactfolio.git

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# æœ¬åœ°å¯å‚è€ƒå‘½ä»¤
Cmd + Shift + P â†’ TypeScript: Restart TS Server

npm install react-intersection-observer

npm install -D @vitejs/plugin-vue tailwindcss postcss autoprefixer

npx tailwindcss init

npm install framer-motion

npm install @supabase/supabase-js

npm install zustand

npm install react-markdown remark-gfm rehype-raw



npm install recharts


Settings/Developer settings/ReactFolio

Homepage URLï¼š
  æœ¬åœ°éƒ¨ç½²ï¼šhttp://localhost:5173
  çº¿ä¸Šéƒ¨ç½²ï¼šhttps://reactfolio-sooty.vercel.app/

```

## ğŸš§ å¼€å‘è®¡åˆ’

åŸºç¡€ç®€å†å±•ç¤º

æ·±è‰²æ¨¡å¼åˆ‡æ¢

æ»šåŠ¨åŠ¨ç”»æ•ˆæœ

åšå®¢æ¨¡å—

å¤šè¯­è¨€æ”¯æŒ

å•å…ƒæµ‹è¯•


===== eslint.config.js =====
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])


===== postcss.config.js =====
// postcss.config.js
export default {
  plugins: {
    "@tailwindcss/postcss": {},
    autoprefixer: {},
  },
};


===== src/App.tsx =====
import React, { useState, useEffect } from "react";
import { BrowserRouter, Routes, Route } from "react-router-dom"; // æ·»åŠ è·¯ç”±
import Header from "./components/Header";
import About from "./components/About";
import Skills from "./components/Skills";
import Projects from "./components/Projects";
import Contact from "./components/Contact";
import BackToTop from "./components/BackToTop";
import ScrollReveal from "./components/ScrollReveal";
import Guestbook from "./components/Guestbook";
import Button from "./components/common/Button";
import GitHubLogin from "./components/GitHubLogin";
import VisitorCounter from "./components/VisitorCounter";
// å¯¼å…¥åšå®¢é¡µé¢
import BlogPage from "./pages/BlogPage";
import PostPage from "./pages/PostPage";
import type { Project, ContactInfo, AboutInfo } from "./types";
import avatarImg from "./assets/avatar.png";
import { useAuthStore } from "./store/authStore";
import { useLikeStore } from "./store/likeStore";
import { supabase } from "./lib/supabase";

// é¡¹ç›®æ•°æ®
const projects: Project[] = [
  {
    name: "ä¸ªäººç®€å†ç½‘é¡µ",
    description:
      "ç”¨React + TypeScriptåˆ¶ä½œçš„ä¸ªäººç®€å†ç½‘é¡µï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ã€å“åº”å¼è®¾è®¡",
    link: "#",
    category: "react",
    tags: ["React", "TypeScript", "Tailwind"],
  },
  {
    name: "å¾…åŠæ¸…å•åº”ç”¨",
    description: "å…¨æ ˆå¾…åŠåº”ç”¨ï¼ŒReact + Node.js + MongoDB",
    link: "#",
    category: "fullstack",
    tags: ["React", "Node.js", "MongoDB"],
  },
  {
    name: "å¤©æ°”æŸ¥è¯¢å°ç¨‹åº",
    description: "å®æ—¶å¤©æ°”æŸ¥è¯¢ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹API",
    link: "#",
    category: "vanilla",
    tags: ["JavaScript", "API"],
  },
];

const contact: ContactInfo = {
  email: "yourname@example.com",
  github: "https://github.com/yourname",
  linkedin: "https://linkedin.com/in/yourname",
};

const about: AboutInfo = {
  bio: "å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œçƒ­çˆ± React å’Œ TypeScriptï¼Œå–œæ¬¢åˆ¶ä½œç®€æ´ç¾è§‚çš„ç½‘é¡µã€‚",
  avatar: avatarImg,
};

// åˆ›å»ºä¸»é¡µå¸ƒå±€ç»„ä»¶
const MainLayout: React.FC = () => {
  const [darkMode, setDarkMode] = useState(false);

  // è·å– store æ–¹æ³•
  const initialize = useAuthStore((state) => state.initialize);
  const user = useAuthStore((state) => state.user);
  const fetchUserLikes = useLikeStore((state) => state.fetchUserLikes);

  // åˆå§‹åŒ–ä¸»é¢˜
  useEffect(() => {
    const savedTheme = localStorage.getItem("theme");
    const isDark = savedTheme === "dark";
    setDarkMode(isDark);
    document.documentElement.classList.toggle("dark", isDark);
  }, []);

  // åˆå§‹åŒ–è®¤è¯å’Œç‚¹èµæ•°æ®
  useEffect(() => {
    initialize();

    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      useAuthStore.setState({ user: session?.user || null });
    });

    return () => {
      subscription.unsubscribe();
    };
  }, [initialize]);

  // å½“ç”¨æˆ·ç™»å½•çŠ¶æ€å˜åŒ–æ—¶ï¼Œè·å–ç”¨æˆ·çš„ç‚¹èµæ•°æ®
  useEffect(() => {
    if (user) {
      fetchUserLikes();
    }
  }, [user, fetchUserLikes]);

  // åˆ‡æ¢ä¸»é¢˜
  const toggleTheme = () => {
    setDarkMode((prev) => {
      const newTheme = !prev;
      localStorage.setItem("theme", newTheme ? "dark" : "light");
      document.documentElement.classList.toggle("dark", newTheme);
      return newTheme;
    });
  };

  return (
    <div className="app max-w-3xl mx-auto p-5 bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors duration-300">
      {/* é¡¶éƒ¨å·¥å…·æ  */}
      <div className="flex justify-between items-center mb-4">
        <VisitorCounter />
        <div className="flex gap-2">
          <Button onClick={toggleTheme}>
            {darkMode ? "â˜€ï¸ äº®è‰²æ¨¡å¼" : "ğŸŒ™ æš—é»‘æ¨¡å¼"}
          </Button>
          <GitHubLogin />
        </div>
      </div>

      {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}
      <Header name="å¼ ä¸‰" title="å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ" />

      <ScrollReveal>
        <About about={about} />
      </ScrollReveal>

      <ScrollReveal>
        <Skills />
      </ScrollReveal>

      <ScrollReveal>
        <Projects projects={projects} />
      </ScrollReveal>

      <ScrollReveal>
        <Contact contact={contact} />
      </ScrollReveal>

      <ScrollReveal>
        <Guestbook />
      </ScrollReveal>

      <BackToTop />
    </div>
  );
};

// ä¸»åº”ç”¨ç»„ä»¶
const App: React.FC = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<MainLayout />} />
        <Route path="/blog" element={<BlogPage />} />
        <Route path="/blog/:slug" element={<PostPage />} />
      </Routes>
    </BrowserRouter>
  );
};

export default App;


===== src/components/About.tsx =====
import React from "react";
import type { AboutInfo } from "../types";

interface AboutProps {
  about: AboutInfo;
}

const About: React.FC<AboutProps> = ({ about }) => {
  return (
    <section className="py-8 px-6 bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-300">
      <div className="flex flex-col md:flex-row items-center gap-6">
        {about.avatar && (
          <img
            src={about.avatar}
            alt="å¤´åƒ"
            className="w-32 h-32 rounded-full object-cover border-4 border-gray-200 dark:border-gray-600"
          />
        )}
        <p className="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
          {about.bio}
        </p>
      </div>
    </section>
  );
};

export default About;


===== src/components/BackToTop.tsx =====
import { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";

const BackToTop = () => {
  const [show, setShow] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      // æ»šåŠ¨è¶…è¿‡400pxæ˜¾ç¤ºæŒ‰é’®
      setShow(window.scrollY > 400);
    };

    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  const scrollToTop = () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth", // å¹³æ»‘æ»šåŠ¨
    });
  };

  return (
    <AnimatePresence>
      {show && (
        <motion.button
          initial={{ opacity: 0, scale: 0.5 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.5 }}
          onClick={scrollToTop}
          className="
            fixed bottom-6 right-6
            p-3 rounded-full
            bg-blue-500 hover:bg-blue-600
            dark:bg-blue-600 dark:hover:bg-blue-700
            text-white shadow-lg
            transition-colors duration-300
            z-50
          "
          aria-label="å›åˆ°é¡¶éƒ¨"
        >
          <svg
            className="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M5 10l7-7m0 0l7 7m-7-7v18"
            />
          </svg>
        </motion.button>
      )}
    </AnimatePresence>
  );
};

export default BackToTop;


===== src/components/Contact.tsx =====
import React from "react";
import type { ContactInfo } from "../types";

interface ContactProps {
  contact: ContactInfo;
}

const Contact: React.FC<ContactProps> = ({ contact }) => {
  return (
    <section className="py-8 bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-300">
      <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center">
        è”ç³»æˆ‘
      </h2>
      <div className="space-y-3">
        <div className="flex items-center gap-3">
          <span className="text-gray-700 dark:text-gray-300">ğŸ“§</span>
          <span className="text-gray-600 dark:text-gray-400">
            {contact.email}
          </span>
        </div>
        <div className="flex items-center gap-3">
          <span className="text-gray-700 dark:text-gray-300">ğŸ’»</span>
          <a
            href={contact.github}
            className="text-blue-600 dark:text-blue-400 hover:underline"
          >
            GitHub
          </a>
        </div>
        <div className="flex items-center gap-3">
          <span className="text-gray-700 dark:text-gray-300">ğŸ‘”</span>
          <a
            href={contact.linkedin}
            className="text-blue-600 dark:text-blue-400 hover:underline"
          >
            LinkedIn
          </a>
        </div>
      </div>
    </section>
  );
};

export default Contact;


===== src/components/GitHubLogin.tsx =====
import React, { useEffect } from "react";
import { useAuthStore } from "../store/authStore";

const GitHubLogin: React.FC = () => {
  const {
    user,
    isLoading,
    error,
    signInWithGitHub,
    signOut,
    clearError,
    initialize,
  } = useAuthStore();

  // åˆå§‹åŒ–è®¤è¯çŠ¶æ€
  useEffect(() => {
    initialize();
  }, []);

  // åŠ è½½çŠ¶æ€
  if (isLoading) {
    return (
      <div className="flex items-center justify-center p-4">
        <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
        <span className="ml-2 text-gray-600 dark:text-gray-400">åŠ è½½ä¸­...</span>
      </div>
    );
  }

  // å·²ç™»å½•çŠ¶æ€
  if (user) {
    return (
      <div className="flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow">
        <img
          src={user.user_metadata.avatar_url}
          alt={user.user_metadata.user_name}
          className="w-10 h-10 rounded-full border-2 border-blue-500"
        />
        <div className="flex-1">
          <p className="font-medium text-gray-900 dark:text-white">
            {user.user_metadata.user_name}
          </p>
          <p className="text-sm text-gray-500 dark:text-gray-400">
            {user.email}
          </p>
        </div>
        <button
          onClick={signOut}
          className="px-4 py-2 text-sm bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors"
        >
          é€€å‡º
        </button>
      </div>
    );
  }

  // æœªç™»å½•çŠ¶æ€
  return (
    <div className="p-4 bg-white dark:bg-gray-800 rounded-lg shadow">
      {error && (
        <div className="mb-4 p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg flex justify-between items-center">
          <span>{error}</span>
          <button
            onClick={clearError}
            className="text-red-500 hover:text-red-700"
          >
            âœ•
          </button>
        </div>
      )}

      <button
        onClick={signInWithGitHub}
        disabled={isLoading}
        className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path
            fillRule="evenodd"
            d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
            clipRule="evenodd"
          />
        </svg>
        <span className="font-medium">ä½¿ç”¨ GitHub ç™»å½•</span>
      </button>

      <p className="mt-3 text-xs text-center text-gray-500 dark:text-gray-400">
        ç™»å½•åå¯ä»¥ç•™è¨€ã€ç‚¹èµ âœ¨
      </p>
    </div>
  );
};

export default GitHubLogin;


===== src/components/Guestbook.tsx =====
// src/components/Guestbook.tsx
import { useState, useEffect, useCallback, useRef } from "react";
import { supabase } from "../lib/supabase";
import { useAuthStore } from "../store/authStore";
import { useLikeStore } from "../store/likeStore";
import type { MessageWithLike } from "../types";
import GuestbookMessage from "./GuestbookMessage";

const PAGE_SIZE = 10;

const Guestbook = () => {
  const [messages, setMessages] = useState<MessageWithLike[]>([]);
  const [content, setContent] = useState("");
  const [loading, setLoading] = useState(false);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  const [total, setTotal] = useState(0);

  const user = useAuthStore((state) => state.user);
  const { likedMessages, fetchUserLikes, toggleLike } = useLikeStore();

  // æ–°å¢ï¼šé˜²é‡å¤è¯·æ±‚ ref
  const fetchingRef = useRef(false);

  // ä¿®æ”¹1ï¼šç¨³å®šçš„ fetchMessagesï¼ˆä¾èµ–æ•°ç»„ä¸ºç©ºï¼‰
  const fetchMessages = useCallback(async (pageNum: number) => {
    // é˜²æ­¢é‡å¤è¯·æ±‚
    if (fetchingRef.current) return;

    fetchingRef.current = true;
    setLoading(true);

    const from = (pageNum - 1) * PAGE_SIZE;
    const to = from + PAGE_SIZE - 1;

    const { data, error } = await supabase
      .from("messages")
      .select("*")
      .order("is_pinned", { ascending: false }) // ç½®é¡¶çš„æ’åœ¨å‰é¢
      .order("created_at", { ascending: false })
      .range(from, to);

    if (error) {
      console.error("Error fetching messages:", error);
      fetchingRef.current = false;
      setLoading(false);
      return;
    }

    if (data) {
      // ç›´æ¥ä» store è·å–æœ€æ–°çš„ç‚¹èµçŠ¶æ€
      const currentLikedMessages = useLikeStore.getState().likedMessages;
      const messagesWithLike = data.map((msg) => ({
        ...msg,
        liked_by_user: currentLikedMessages.has(msg.id),
      }));

      if (pageNum === 1) {
        setMessages(messagesWithLike);
      } else {
        setMessages((prev) => [...prev, ...messagesWithLike]);
      }

      setHasMore(data.length === PAGE_SIZE);
    }

    fetchingRef.current = false;
    setLoading(false);
  }, []); // ç©ºæ•°ç»„ï¼Œå‡½æ•°æ°¸ä¸é‡æ–°åˆ›å»º

  // ä¿®æ”¹2ï¼šåˆå§‹åŒ–åªæ‰§è¡Œä¸€æ¬¡
  useEffect(() => {
    const init = async () => {
      // è·å–æ€»æ•°
      const { count } = await supabase
        .from("messages")
        .select("*", { count: "exact", head: true });
      setTotal(count || 0);

      // å¦‚æœå·²ç™»å½•ï¼Œè·å–ç‚¹èµæ•°æ®
      if (user) {
        await fetchUserLikes();
      }

      // è·å–ç¬¬ä¸€é¡µç•™è¨€
      await fetchMessages(1);
    };

    init();
  }, []); // ç©ºæ•°ç»„ï¼Œåªæ‰§è¡Œä¸€æ¬¡

  // ä¿®æ”¹3ï¼šåˆ†é¡µåŠ è½½
  useEffect(() => {
    if (page > 1) {
      // é¿å…ç¬¬ä¸€é¡µé‡å¤åŠ è½½
      fetchMessages(page);
    }
  }, [page]); // åªä¾èµ– page

  // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶åŒæ­¥ä¸€æ¬¡ç‚¹èµçŠ¶æ€
  useEffect(() => {
    if (messages.length > 0 && likedMessages.size > 0) {
      setMessages((prev) =>
        prev.map((msg) => ({
          ...msg,
          liked_by_user: likedMessages.has(msg.id),
        })),
      );
    }
  }, []); // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡

  // å‘å¸ƒç•™è¨€
  const submitMessage = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!user) {
      alert("è¯·å…ˆç™»å½•åå†ç•™è¨€");
      return;
    }

    if (!content.trim()) return;

    setLoading(true);
    const { error, data } = await supabase
      .from("messages")
      .insert([
        {
          name: user.user_metadata?.user_name || "åŒ¿å",
          content,
          user_id: user.id,
          avatar_url: user.user_metadata?.avatar_url,
          likes_count: 0,
        },
      ])
      .select()
      .single();

    if (!error && data) {
      setContent("");
      setPage(1);
      fetchMessages(1);
      // æ›´æ–°æ€»æ•°
      const { count } = await supabase
        .from("messages")
        .select("*", { count: "exact", head: true });
      setTotal(count || 0);
    }
    setLoading(false);
  };

  // å¤„ç†ç‚¹èµ
  const handleLike = async (messageId: number) => {
    if (!user) {
      alert("è¯·å…ˆç™»å½•åå†ç‚¹èµ");
      return;
    }

    // ä¹è§‚æ›´æ–° UI
    setMessages((prev) =>
      prev.map((msg) => {
        if (msg.id === messageId) {
          return {
            ...msg,
            likes_count: (msg.likes_count || 0) + (msg.liked_by_user ? -1 : 1),
            liked_by_user: !msg.liked_by_user,
          };
        }
        return msg;
      }),
    );

    // è°ƒç”¨ store çš„ toggleLike
    await toggleLike(messageId);
  };

  // åŠ è½½æ›´å¤š
  const loadMore = () => {
    if (hasMore && !loading && !fetchingRef.current) {
      setPage((prev) => prev + 1);
    }
  };

  // ç¼–è¾‘ç•™è¨€
  const handleEdit = async (messageId: number, newContent: string) => {
    if (!user) return;

    try {
      const { error } = await supabase
        .from("messages")
        .update({ content: newContent })
        .eq("id", messageId)
        .eq("user_id", user.id);

      if (error) throw error;

      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      setMessages((prev) =>
        prev.map((msg) =>
          msg.id === messageId ? { ...msg, content: newContent } : msg,
        ),
      );
    } catch (error) {
      console.error("Error editing message:", error);
      alert("ç¼–è¾‘å¤±è´¥ï¼Œè¯·é‡è¯•");
    }
  };

  // åˆ é™¤ç•™è¨€
  const handleDelete = async (messageId: number) => {
    if (!user) return;

    try {
      const { error } = await supabase
        .from("messages")
        .delete()
        .eq("id", messageId)
        .eq("user_id", user.id);

      if (error) throw error;

      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      setMessages((prev) => prev.filter((msg) => msg.id !== messageId));

      // æ›´æ–°æ€»æ•°
      setTotal((prev) => prev - 1);
    } catch (error) {
      console.error("Error deleting message:", error);
      alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•");
    }
  };

  const handleTogglePin = async (messageId: number) => {
    if (!user) return;

    // æ£€æŸ¥æ˜¯å¦æœ‰ç®¡ç†å‘˜æƒé™
    const isAdmin = user.email === "mydykitty@126.com"; // æ”¹æˆä½ çš„ç®¡ç†å‘˜é‚®ç®±

    if (!isAdmin) {
      alert("åªæœ‰ç®¡ç†å‘˜å¯ä»¥ç½®é¡¶ç•™è¨€");
      return;
    }

    try {
      // æ‰¾åˆ°å½“å‰æ¶ˆæ¯
      const targetMessage = messages.find((msg) => msg.id === messageId);
      if (!targetMessage) return;

      // æ›´æ–°æ•°æ®åº“
      const { error } = await supabase
        .from("messages")
        .update({ is_pinned: !targetMessage.is_pinned })
        .eq("id", messageId);

      if (error) throw error;

      // **å…³é”®ä¿®å¤ï¼šé‡æ–°æ’åºæ¶ˆæ¯åˆ—è¡¨**
      setMessages((prev) => {
        // å…ˆæ›´æ–°ç›®æ ‡æ¶ˆæ¯çš„ is_pinned çŠ¶æ€
        const updatedMessages = prev.map((msg) =>
          msg.id === messageId ? { ...msg, is_pinned: !msg.is_pinned } : msg,
        );

        // ç„¶åé‡æ–°æ’åºï¼šç½®é¡¶çš„åœ¨å‰ï¼ŒæŒ‰æ—¶é—´å€’åº
        return updatedMessages.sort((a, b) => {
          // å…ˆæŒ‰ç½®é¡¶çŠ¶æ€æ’åº
          if (a.is_pinned && !b.is_pinned) return -1;
          if (!a.is_pinned && b.is_pinned) return 1;
          // å†æŒ‰æ—¶é—´æ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰
          return (
            new Date(b.created_at).getTime() - new Date(a.created_at).getTime()
          );
        });
      });
    } catch (error) {
      console.error("Error toggling pin:", error);
      alert("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•");
      // å‡ºé”™æ—¶é‡æ–°è·å–æ•°æ®
      fetchMessages(1);
    }
  };

  return (
    <section className="py-8 px-6 bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-300">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-900 dark:text-white">
          ğŸ’¬ è®¿å®¢ç•™è¨€æ¿
        </h2>
        <span className="text-sm text-gray-500 dark:text-gray-400">
          å…± {total} æ¡ç•™è¨€
        </span>
      </div>

      {/* ç•™è¨€è¡¨å• */}
      {user ? (
        <form onSubmit={submitMessage} className="mb-8">
          <div className="flex gap-3">
            <img
              src={user.user_metadata?.avatar_url}
              alt={user.user_metadata?.user_name}
              className="w-10 h-10 rounded-full flex-shrink-0"
            />
            <div className="flex-1">
              <textarea
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
                rows={2}
                className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                required
              />
              <div className="flex justify-end mt-2">
                <button
                  type="submit"
                  disabled={loading}
                  className="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? "å‘å¸ƒä¸­..." : "å‘å¸ƒç•™è¨€"}
                </button>
              </div>
            </div>
          </div>
        </form>
      ) : (
        <div className="mb-8 p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 text-center rounded-lg">
          è¯·å…ˆç™»å½•åå†ç•™è¨€
        </div>
      )}

      {/* ç•™è¨€åˆ—è¡¨ - ä½¿ç”¨ GuestbookMessage ç»„ä»¶ */}
      <div className="space-y-4">
        {messages.map((msg) => (
          <GuestbookMessage
            key={msg.id}
            message={msg}
            currentUser={user}
            onLike={handleLike}
            onEdit={handleEdit}
            onDelete={handleDelete}
            onTogglePin={handleTogglePin} // æ–°å¢è¿™è¡Œ
          />
        ))}

        {/* åŠ è½½æ›´å¤š */}
        {hasMore && (
          <div className="text-center pt-4">
            <button
              onClick={loadMore}
              disabled={loading}
              className="px-6 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg transition-colors duration-300 disabled:opacity-50"
            >
              {loading ? "åŠ è½½ä¸­..." : "åŠ è½½æ›´å¤šç•™è¨€"}
            </button>
          </div>
        )}

        {messages.length === 0 && !loading && (
          <p className="text-center text-gray-500 dark:text-gray-400 py-8">
            è¿˜æ²¡æœ‰ç•™è¨€ï¼Œæ¥å½“ç¬¬ä¸€ä¸ªè®¿å®¢å§ï¼ âœ¨
          </p>
        )}
      </div>
    </section>
  );
};

export default Guestbook;


===== src/components/GuestbookMessage.tsx =====
// src/components/GuestbookMessage.tsx
import { useState } from "react";
import type { MessageWithLike } from "../types";
import type { User } from "@supabase/supabase-js";

interface GuestbookMessageProps {
  message: MessageWithLike;
  currentUser: User | null;
  onLike: (id: number) => void;
  onEdit: (id: number, content: string) => Promise<void>;
  onDelete: (id: number) => Promise<void>;
  onTogglePin: (id: number) => Promise<void>; // æ–°å¢
}

const GuestbookMessage = ({
  message,
  currentUser,
  onLike,
  onEdit,
  onDelete,
  onTogglePin,
}: GuestbookMessageProps) => {
  const [isEditing, setIsEditing] = useState(false);
  const [editContent, setEditContent] = useState(message.content);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const isOwnMessage = currentUser?.id === message.user_id;

  const handleEdit = async () => {
    if (!editContent.trim() || editContent === message.content) {
      setIsEditing(false);
      return;
    }

    setIsSubmitting(true);
    try {
      await onEdit(message.id, editContent.trim());
      setIsEditing(false);
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleDelete = async () => {
    if (window.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç•™è¨€å—ï¼Ÿ")) {
      await onDelete(message.id);
    }
  };

  const isAdmin = currentUser?.email === 'mydykitty@126.com'; // æ”¹æˆä½ çš„ç®¡ç†å‘˜é‚®ç®±

  return (
    <div className="flex gap-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600">
      {/* å¤´åƒ */}
      <img
        src={message.avatar_url || `https://github.com/${message.name}.png`}
        alt={message.name}
        className="w-10 h-10 rounded-full flex-shrink-0"
        onError={(e) => {
          e.currentTarget.src = `https://ui-avatars.com/api/?name=${message.name}&background=random`;
        }}
      />

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="flex-1 min-w-0">
        {/* å¤´éƒ¨ï¼šç”¨æˆ·å + æ—¶é—´ + æ“ä½œæŒ‰é’® */}
        <div className="flex justify-between items-start gap-2">
          <div className="flex items-center gap-2">
            <div className="flex items-center gap-2">
              <span className="font-medium text-blue-600 dark:text-blue-400">
                {message.name}
              </span>
              {message.is_pinned && (
                <span className="text-yellow-500" title="ç½®é¡¶ç•™è¨€">
                  ğŸ“Œ
                </span>
              )}
            </div>
            {isOwnMessage && (
              <span className="text-xs bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">
                æˆ‘
              </span>
            )}
          </div>

          <div className="flex items-center gap-2">
            <span className="text-xs text-gray-500 dark:text-gray-400">
              {new Date(message.created_at).toLocaleString("zh-CN")}
            </span>

            {/* ç¼–è¾‘/åˆ é™¤æŒ‰é’® - åªæœ‰è‡ªå·±çš„ç•™è¨€æ‰æ˜¾ç¤º */}
            {!isEditing && (
                <div className="flex gap-1">
                  {/* ç½®é¡¶æŒ‰é’® - ç®¡ç†å‘˜å¯è§ï¼ˆå¯ä»¥æ“ä½œæ‰€æœ‰ç•™è¨€ï¼‰ */}
                  {isAdmin && (
                      <button
                          onClick={() => onTogglePin(message.id)}
                          className={`transition-colors p-1 ${
                              message.is_pinned
                                  ? 'text-yellow-500 hover:text-yellow-600'
                                  : 'text-gray-400 hover:text-yellow-500'
                          }`}
                          title={message.is_pinned ? "å–æ¶ˆç½®é¡¶" : "ç½®é¡¶ç•™è¨€"}
                      >
                        ğŸ“Œ
                      </button>
                  )}

                  {/* ç¼–è¾‘/åˆ é™¤æŒ‰é’® - åªæœ‰è‡ªå·±çš„ç•™è¨€æ‰æ˜¾ç¤º */}
                  {isOwnMessage && (
                      <>
                        <button
                            onClick={() => setIsEditing(true)}
                            className="text-gray-400 hover:text-blue-500 transition-colors p-1"
                            title="ç¼–è¾‘"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
                                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                          </svg>
                        </button>
                        <button
                            onClick={handleDelete}
                            className="text-gray-400 hover:text-red-500 transition-colors p-1"
                            title="åˆ é™¤"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
                                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </>
                  )}
                </div>
            )}
          </div>
        </div>

        {/* å†…å®¹åŒºåŸŸï¼šç¼–è¾‘æ¨¡å¼æˆ–æ˜¾ç¤ºæ¨¡å¼ */}
        {isEditing ? (
          <div className="mt-2">
            <textarea
              value={editContent}
              onChange={(e) => setEditContent(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"
              rows={3}
              autoFocus
              disabled={isSubmitting}
            />
            <div className="flex justify-end gap-2 mt-2">
              <button
                onClick={() => {
                  setIsEditing(false);
                  setEditContent(message.content);
                }}
                className="px-3 py-1 text-sm bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors"
                disabled={isSubmitting}
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={handleEdit}
                disabled={isSubmitting || !editContent.trim()}
                className="px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors disabled:opacity-50"
              >
                {isSubmitting ? "ä¿å­˜ä¸­..." : "ä¿å­˜"}
              </button>
            </div>
          </div>
        ) : (
          <p className="mt-1 text-gray-700 dark:text-gray-300 break-words whitespace-pre-wrap">
            {message.content}
          </p>
        )}

        {/* ç‚¹èµæŒ‰é’® */}
        <div className="mt-2 flex items-center gap-4">
          <button
            onClick={() => onLike(message.id)}
            disabled={!currentUser}
            className={`flex items-center gap-1 text-sm transition-colors ${
              !currentUser
                ? "opacity-50 cursor-not-allowed"
                : "hover:text-blue-500"
            } ${
              message.liked_by_user
                ? "text-blue-500"
                : "text-gray-500 dark:text-gray-400"
            }`}
          >
            <svg
              className={`w-5 h-5 ${message.liked_by_user ? "fill-current" : ""}`}
              fill={message.liked_by_user ? "currentColor" : "none"}
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              />
            </svg>
            <span>{message.likes_count || 0}</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default GuestbookMessage;


===== src/components/Header.tsx =====
import React from "react";
import Typewriter from "./Typewriter";

interface HeaderProps {
  name: string;
  title: string;
}

const Header: React.FC<HeaderProps> = ({ name, title }) => {
  return (
    <header className="text-center py-8 bg-white dark:bg-gray-900 transition-colors duration-300">
      <h1 className="text-4xl font-bold text-gray-900 dark:text-white mb-2">
        {name}
      </h1>
      <h3 className="text-xl text-gray-600 dark:text-gray-300">
        <Typewriter
          texts={[title, "React çˆ±å¥½è€…", "TypeScript ç©å®¶", "UI è®¾è®¡æ§"]}
        />
      </h3>
    </header>
  );
};

export default Header;


===== src/components/Projects.tsx =====
import React, { useState } from "react";
import type { Project } from "../types";

interface ProjectsProps {
  projects: Project[];
}

const Projects: React.FC<ProjectsProps> = ({ projects }) => {
  const [filter, setFilter] = useState("all");

  // è·å–æ‰€æœ‰åˆ†ç±»ï¼ˆå»é‡ï¼‰
  const categories = [
    "all",
    ...new Set(
      projects
        .map((p) => p.category)
        .filter((c): c is string => c !== undefined), // åªä¿ç•™ string
    ),
  ];

  // ç­›é€‰é¡¹ç›®
  const filteredProjects =
    filter === "all" ? projects : projects.filter((p) => p.category === filter);

  return (
    <section className="py-8 bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-300">
      <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center">
        é¡¹ç›®
      </h2>

      {/* ç­›é€‰æŒ‰é’®ç»„ */}
      <div className="flex flex-wrap justify-center gap-2 mb-6">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setFilter(category)}
            className={`
              px-4 py-2 rounded-full text-sm font-medium
              transition-all duration-300
              ${
                filter === category
                  ? "bg-blue-500 text-white shadow-md"
                  : "bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"
              }
            `}
          >
            {category === "all" ? "å…¨éƒ¨" : category}
          </button>
        ))}
      </div>

      {/* é¡¹ç›®åˆ—è¡¨ */}
      <div className="space-y-4">
        {filteredProjects.map((project, index) => (
          <div
            key={index}
            className="p-4 border border-gray-200 dark:border-gray-600 rounded-lg hover:shadow-lg transition-shadow"
          >
            <h3 className="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">
              {project.name}
            </h3>
            <p className="text-gray-600 dark:text-gray-400 mb-2">
              {project.description}
            </p>

            {/* æ ‡ç­¾äº‘ */}
            {project.tags && (
              <div className="flex flex-wrap gap-2 mb-3">
                {project.tags.map((tag) => (
                  <span
                    key={tag}
                    className="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded"
                  >
                    {tag}
                  </span>
                ))}
              </div>
            )}

            {project.link && project.link !== "#" && (
              <a
                href={project.link}
                className="text-blue-600 dark:text-blue-400 hover:underline"
              >
                æŸ¥çœ‹é¡¹ç›® â†’
              </a>
            )}
          </div>
        ))}
      </div>

      {/* ç©ºçŠ¶æ€ */}
      {filteredProjects.length === 0 && (
        <p className="text-center text-gray-500 dark:text-gray-400 py-8">
          æš‚æ— è¯¥åˆ†ç±»çš„é¡¹ç›®
        </p>
      )}
    </section>
  );
};

export default Projects;


===== src/components/ScrollReveal.tsx =====
import { useInView } from "react-intersection-observer";
import type { FC, ReactNode } from "react";

interface ScrollRevealProps {
  children: ReactNode;
}

const ScrollReveal: FC<ScrollRevealProps> = ({ children }) => {
  const { ref, inView } = useInView({
    triggerOnce: true, // åªè§¦å‘ä¸€æ¬¡
    threshold: 0.2, // 20% å‡ºç°åœ¨è§†å£æ‰è§¦å‘
  });

  return (
    <div ref={ref} className={`scroll-section ${inView ? "show" : ""}`}>
      {children}
    </div>
  );
};

export default ScrollReveal;


===== src/components/Skills.tsx =====
import type { FC } from "react";
import { useEffect, useState } from "react";
import { skills } from "../data/skills";
import type { Skill } from "../data/skills";
import { useInView } from "react-intersection-observer";

const Skills: FC = () => {
  // ç›‘å¬æ•´ä¸ª Skills åŒºå—æ˜¯å¦è¿›å…¥è§†å£
  const { ref, inView } = useInView({ triggerOnce: true });

  // åˆå§‹åŒ–æ¯ä¸ªæŠ€èƒ½ç­‰çº§ä¸º 0
  const [animatedLevels, setAnimatedLevels] = useState<Skill[]>(
    skills.map((s) => ({ ...s, level: 0 })),
  );

  // ç»„ä»¶æŒ‚è½½åï¼Œå¦‚æœ inView ä¸º trueï¼Œä¾æ¬¡åŠ¨ç”»æ¯ä¸ªæŠ€èƒ½æ¡
  useEffect(() => {
    if (!inView) return;

    skills.forEach((skill, idx) => {
      setTimeout(() => {
        setAnimatedLevels((prev) => {
          const copy = [...prev];
          copy[idx] = { ...copy[idx], level: skill.level };
          return copy;
        });
      }, idx * 200); // æ¯ä¸ªæŠ€èƒ½æ¡å»¶è¿Ÿ 200ms åŠ¨ç”»
    });
  }, [inView]);

  return (
    <section
      ref={ref}
      className="max-w-4xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg transition-colors duration-300"
    >
      <h2 className="text-2xl font-bold mb-4">Skills</h2>
      <div className="space-y-4">
        {animatedLevels.map((skill) => (
          <div key={skill.name}>
            <div className="flex justify-between mb-1">
              <span className="font-medium">{skill.name}</span>
              <span className="text-sm">{skill.level}%</span>
            </div>
            <div className="w-full bg-gray-200 h-4 rounded overflow-hidden shadow-inner">
              <div
                className="bg-blue-500 h-4 rounded transition-all duration-1000 ease-out shadow-md"
                style={{ width: `${skill.level}%` }}
              ></div>
            </div>
          </div>
        ))}
      </div>
    </section>
  );
};

export default Skills;


===== src/components/Typewriter.tsx =====
import { useState, useEffect } from "react";

interface TypewriterProps {
  texts: string[]; // è¦è½®æ¢çš„æ–‡å­—æ•°ç»„
  delay?: number; // æ‰“å­—é€Ÿåº¦
  pause?: number; // æš‚åœæ—¶é—´
}

const Typewriter: React.FC<TypewriterProps> = ({
  texts,
  delay = 100,
  pause = 2000,
}) => {
  const [currentTextIndex, setCurrentTextIndex] = useState(0);
  const [currentText, setCurrentText] = useState("");
  const [isDeleting, setIsDeleting] = useState(false);

  useEffect(() => {
    const timer = setTimeout(
      () => {
        const fullText = texts[currentTextIndex];

        if (!isDeleting) {
          // æ‰“å­—
          if (currentText.length < fullText.length) {
            setCurrentText(fullText.slice(0, currentText.length + 1));
          } else {
            // æ‰“å®Œäº†ï¼Œç­‰å¾…åå¼€å§‹åˆ é™¤
            setTimeout(() => setIsDeleting(true), pause);
          }
        } else {
          // åˆ é™¤
          if (currentText.length > 0) {
            setCurrentText(currentText.slice(0, -1));
          } else {
            // åˆ å®Œäº†ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè¯
            setIsDeleting(false);
            setCurrentTextIndex((prev) => (prev + 1) % texts.length);
          }
        }
      },
      isDeleting ? delay / 2 : delay,
    );

    return () => clearTimeout(timer);
  }, [currentText, currentTextIndex, isDeleting, texts, delay, pause]);

  return (
    <span className="inline-block min-w-[200px] text-blue-600 dark:text-blue-400">
      {currentText}
      <span className="animate-pulse">|</span>
    </span>
  );
};

export default Typewriter;


===== src/components/VisitorCounter.tsx =====
// src/components/VisitorCounter.tsx
import { useState, useEffect } from "react";
import { supabase } from "../lib/supabase";

const VisitorCounter = () => {
  const [count, setCount] = useState<number | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const handleVisitor = async () => {
      try {
        // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨æœ¬ä¼šè¯ä¸­è®¿é—®è¿‡
        const hasVisited = sessionStorage.getItem("hasVisited");

        if (!hasVisited) {
          // æ–°è®¿å®¢ï¼šå…ˆè·å–å½“å‰è®¡æ•°
          const { data: currentData, error: selectError } = await supabase
            .from("site_stats")
            .select("visitor_count")
            .eq("id", 1)
            .single();

          if (selectError) throw selectError;

          // æ›´æ–°è®¡æ•° +1
          const newCount = (currentData?.visitor_count || 0) + 1;
          const { error: updateError } = await supabase
            .from("site_stats")
            .update({
              visitor_count: newCount,
              updated_at: new Date().toISOString(),
            })
            .eq("id", 1);

          if (updateError) throw updateError;

          setCount(newCount);
          sessionStorage.setItem("hasVisited", "true");
        } else {
          // è€è®¿å®¢ï¼šåªè·å–å½“å‰è®¡æ•°
          const { data, error } = await supabase
            .from("site_stats")
            .select("visitor_count")
            .eq("id", 1)
            .single();

          if (error) throw error;
          setCount(data.visitor_count);
        }
      } catch (error) {
        console.error("Error updating visitor count:", error);
        // å‡ºé”™æ—¶æ˜¾ç¤ºé»˜è®¤å€¼
        setCount(0);
      } finally {
        setLoading(false);
      }
    };

    handleVisitor();
  }, []);

  if (loading) {
    return (
      <div className="text-sm text-gray-400 dark:text-gray-500 animate-pulse">
        Â·Â·Â·
      </div>
    );
  }

  return (
    <div className="flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-400">
      <svg
        className="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          strokeWidth={2}
          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
        />
      </svg>
      <span>{count}</span>
    </div>
  );
};

export default VisitorCounter;


===== src/components/blog/BlogCard.tsx =====
// åšå®¢åˆ—è¡¨ç»„ä»¶
import React from "react";
import { Link } from "react-router-dom";
import type { Post } from "../../types/blog";

interface BlogCardProps {
  post: Post;
}

const BlogCard: React.FC<BlogCardProps> = ({ post }) => {
  return (
    <article className="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
      {post.cover_image && (
        <img
          src={post.cover_image}
          alt={post.title}
          className="w-full h-48 object-cover"
        />
      )}
      <div className="p-6">
        <div className="flex gap-2 mb-2">
          {post.tags?.map((tag) => (
            <span
              key={tag}
              className="text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-2 py-1 rounded"
            >
              #{tag}
            </span>
          ))}
        </div>
        <Link to={`/blog/${post.slug}`}>
          <h3 className="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 mb-2">
            {post.title}
          </h3>
        </Link>
        <p className="text-gray-600 dark:text-gray-400 mb-4">
          {post.excerpt || post.content.substring(0, 150) + "..."}
        </p>
        <div className="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
          <span>{new Date(post.published_at).toLocaleDateString("zh-CN")}</span>
          <div className="flex gap-4">
            <span>ğŸ‘ï¸ {post.view_count}</span>
            <span>â¤ï¸ {post.like_count}</span>
            <span>ğŸ’¬ {post.comment_count}</span>
          </div>
        </div>
      </div>
    </article>
  );
};

export default BlogCard;


===== src/components/common/Button.tsx =====
import type { FC, ButtonHTMLAttributes } from "react";

const Button: FC<ButtonHTMLAttributes<HTMLButtonElement>> = (props) => (
  <button
    {...props}
    className="rounded border border-transparent px-4 py-2 font-medium cursor-pointer transition-colors duration-300 bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"
  />
);

export default Button;


===== src/components/common/Card.tsx =====
import type { FC, ReactNode } from "react";

interface CardProps {
  children: ReactNode;
}

const Card: FC<CardProps> = ({ children }) => (
  <div className="p-4 border rounded-lg bg-white dark:bg-gray-800 shadow hover:shadow-lg transition-shadow mb-4">
    {children}
  </div>
);

export default Card;


===== src/components/common/Section.tsx =====
import type { FC, ReactNode } from "react";

interface SectionProps {
  title?: string;
  children: ReactNode;
}

const Section: FC<SectionProps> = ({ title, children }) => {
  return (
    <section className="mb-8">
      {title && <h2 className="text-2xl font-bold mb-4">{title}</h2>}
      {children}
    </section>
  );
};

export default Section;


===== src/data/skills.ts =====
export interface Skill {
  name: string;
  level: number; // 0~100
}

export const skills: Skill[] = [
  { name: "HTML", level: 90 },
  { name: "CSS", level: 85 },
  { name: "JavaScript", level: 80 },
  { name: "TypeScript", level: 75 },
  { name: "React", level: 85 },
  { name: "TailwindCSS", level: 70 },
];


===== src/index.css =====
@import "tailwindcss";
@custom-variant dark (&:where(.dark, .dark *)); /* æ‰‹åŠ¨å¯ç”¨ dark variant */

/* åŸºç¡€æ ·å¼ï¼Œè®©Tailwindå¤„ç†ä¸»é¢˜åˆ‡æ¢ */
body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* src/index.css æœ«å°¾æ·»åŠ  */
.scroll-section {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.scroll-section.show {
  opacity: 1;
  transform: translateY(0);
}

===== src/lib/supabase.ts =====
import { createClient } from '@supabase/supabase-js';

// ä» Supabase é¡¹ç›®è®¾ç½®ä¸­å¤åˆ¶
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error('ç¼ºå°‘ Supabase ç¯å¢ƒå˜é‡');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

===== src/main.tsx =====
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "./index.css";
import App from "./App.tsx";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <App />
  </StrictMode>,
);


===== src/pages/BlogPage.tsx =====
import React, { useEffect, useState } from "react";
import { supabase } from "../lib/supabase";
import BlogCard from "../components/blog/BlogCard";
import type { Post } from "../types/blog";

const BlogPage: React.FC = () => {
  const [posts, setPosts] = useState<Post[]>([]);
  const [loading, setLoading] = useState(true);
  const [categories, setCategories] = useState([]);
  const [selectedCategory, setSelectedCategory] = useState<number | null>(null);

  useEffect(() => {
    fetchPosts();
    fetchCategories();
  }, [selectedCategory]);

  const fetchPosts = async () => {
    setLoading(true);
    let query = supabase
      .from("posts")
      .select(
        `
        *,
        category:categories(*)
      `,
      )
      .eq("is_published", true)
      .order("published_at", { ascending: false });

    if (selectedCategory) {
      query = query.eq("category_id", selectedCategory);
    }

    const { data } = await query;
    setPosts(data || []);
    setLoading(false);
  };

  const fetchCategories = async () => {
    const { data } = await supabase
      .from("categories")
      .select("*")
      .order("post_count", { ascending: false });
    setCategories(data || []);
  };

  return (
    <div className="max-w-6xl mx-auto px-4 py-8">
      <div className="flex gap-8">
        {/* ä¾§è¾¹æ  */}
        <aside className="w-64 flex-shrink-0">
          <div className="bg-white dark:bg-gray-800 rounded-lg p-6 sticky top-4">
            <h3 className="font-bold mb-4">åˆ†ç±»</h3>
            <ul className="space-y-2">
              <li>
                <button
                  onClick={() => setSelectedCategory(null)}
                  className={`w-full text-left px-3 py-2 rounded transition-colors ${
                    selectedCategory === null
                      ? "bg-blue-500 text-white"
                      : "hover:bg-gray-100 dark:hover:bg-gray-700"
                  }`}
                >
                  å…¨éƒ¨æ–‡ç« 
                </button>
              </li>
              {categories.map((cat) => (
                <li key={cat.id}>
                  <button
                    onClick={() => setSelectedCategory(cat.id)}
                    className={`w-full text-left px-3 py-2 rounded transition-colors flex justify-between ${
                      selectedCategory === cat.id
                        ? "bg-blue-500 text-white"
                        : "hover:bg-gray-100 dark:hover:bg-gray-700"
                    }`}
                  >
                    <span>{cat.name}</span>
                    <span className="text-sm">{cat.post_count}</span>
                  </button>
                </li>
              ))}
            </ul>
          </div>
        </aside>

        {/* æ–‡ç« åˆ—è¡¨ */}
        <main className="flex-1">
          <h1 className="text-3xl font-bold mb-8">åšå®¢æ–‡ç« </h1>

          {loading ? (
            <div className="text-center py-12">åŠ è½½ä¸­...</div>
          ) : posts.length === 0 ? (
            <div className="text-center py-12 text-gray-500">æš‚æ— æ–‡ç« </div>
          ) : (
            <div className="grid gap-6">
              {posts.map((post) => (
                <BlogCard key={post.id} post={post} />
              ))}
            </div>
          )}
        </main>
      </div>
    </div>
  );
};

export default BlogPage;


===== src/pages/PostPage.tsx =====
import React, { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import ReactMarkdown from "react-markdown";
import remarkGfm from "remark-gfm";
import { supabase } from "../lib/supabase";
import type { Post } from "../types/blog";

const PostPage: React.FC = () => {
  const { slug } = useParams();
  const [post, setPost] = useState<Post | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchPost();
  }, [slug]);

  const fetchPost = async () => {
    // è·å–æ–‡ç« è¯¦æƒ…
    const { data, error } = await supabase
      .from("posts")
      .select(
        `
        *,
        category:categories(*)
      `,
      )
      .eq("slug", slug)
      .single();

    if (data) {
      setPost(data);
      // å¢åŠ æµè§ˆé‡
      await supabase
        .from("posts")
        .update({ view_count: (data.view_count || 0) + 1 })
        .eq("id", data.id);
    }
    setLoading(false);
  };

  if (loading) return <div className="text-center py-12">åŠ è½½ä¸­...</div>;
  if (!post) return <div className="text-center py-12">æ–‡ç« ä¸å­˜åœ¨</div>;

  return (
    <article className="max-w-3xl mx-auto px-4 py-8">
      {/* å°é¢å›¾ */}
      {post.cover_image && (
        <img
          src={post.cover_image}
          alt={post.title}
          className="w-full h-96 object-cover rounded-lg mb-8"
        />
      )}

      {/* æ ‡é¢˜åŒºåŸŸ */}
      <h1 className="text-4xl font-bold mb-4">{post.title}</h1>

      <div className="flex items-center gap-4 mb-8 text-gray-500 dark:text-gray-400">
        <span>ğŸ“… {new Date(post.published_at).toLocaleDateString()}</span>
        <span>ğŸ‘ï¸ {post.view_count} é˜…è¯»</span>
        <span>â¤ï¸ {post.like_count} ç‚¹èµ</span>
      </div>

      {/* æ ‡ç­¾ */}
      <div className="flex gap-2 mb-8">
        {post.tags?.map((tag) => (
          <span
            key={tag}
            className="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full text-sm"
          >
            #{tag}
          </span>
        ))}
      </div>

      {/* Markdownå†…å®¹ */}
      <div className="prose dark:prose-invert max-w-none">
        <ReactMarkdown remarkPlugins={[remarkGfm]}>
          {post.content}
        </ReactMarkdown>
      </div>

      {/* ç‚¹èµæŒ‰é’® */}
      <div className="mt-12 flex justify-center">
        <button className="flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
          <span>â¤ï¸</span>
          <span>ç‚¹èµ {post.like_count}</span>
        </button>
      </div>
    </article>
  );
};

export default PostPage;


===== src/store/authStore.ts =====
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { supabase } from '../lib/supabase';
import type { User } from '@supabase/supabase-js';

interface AuthState {
  // çŠ¶æ€
  user: User | null;
  isLoading: boolean;
  error: string | null;
  
  // æ–¹æ³•
  signInWithGitHub: () => Promise<void>;
  signOut: () => Promise<void>;
  initialize: () => Promise<void>;
  clearError: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, _get) => ({
      // åˆå§‹çŠ¶æ€
      user: null,
      isLoading: true,
      error: null,

      // GitHub ç™»å½•
      signInWithGitHub: async () => {
        try {
          set({ isLoading: true, error: null });
          
          const { error } = await supabase.auth.signInWithOAuth({
            provider: 'github',
            options: {
              redirectTo: window.location.origin,
              scopes: 'read:user user:email'  // è¯·æ±‚æ›´å¤šæƒé™
            }
          });

          if (error) throw error;
          
        } catch (error: any) {
          set({ error: error.message });
        } finally {
          set({ isLoading: false });
        }
      },

      // é€€å‡ºç™»å½•
      signOut: async () => {
        try {
          set({ isLoading: true });
          await supabase.auth.signOut();
          set({ user: null });
        } catch (error: any) {
          set({ error: error.message });
        } finally {
          set({ isLoading: false });
        }
      },

      // åˆå§‹åŒ–ï¼šæ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€
      initialize: async () => {
        try {
          set({ isLoading: true });
          
          // è·å–å½“å‰ä¼šè¯
          const { data: { session } } = await supabase.auth.getSession();
          
          if (session?.user) {
            set({ user: session.user });
          }

        } catch (error: any) {
          set({ error: error.message });
        } finally {
          set({ isLoading: false });
        }
      },

      // æ¸…é™¤é”™è¯¯
      clearError: () => set({ error: null })
    }),
    {
      name: 'auth-storage', // localStorage çš„ key
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({ user: state.user }) // åªæŒä¹…åŒ– user
    }
  )
);

===== src/store/likeStore.ts =====
// src/store/likeStore.ts
import { create } from 'zustand';
import { supabase } from '../lib/supabase';
import { useAuthStore } from './authStore';

interface LikeState {
  likedMessages: Set<number>;
  loading: boolean;
  fetchUserLikes: () => Promise<void>;
  toggleLike: (messageId: number) => Promise<void>;
}

export const useLikeStore = create<LikeState>((set, get) => ({
  likedMessages: new Set(),
  loading: false,

  fetchUserLikes: async () => {
    const user = useAuthStore.getState().user;
    if (!user) return;

    // æ–°å¢ï¼šå¦‚æœå·²ç»åœ¨åŠ è½½ä¸­ï¼Œç›´æ¥è¿”å›
    if (get().loading) return;

    // æ–°å¢ï¼šå¦‚æœå·²ç»æœ‰æ•°æ®ï¼Œä¸å†é‡å¤è¯·æ±‚
    if (get().likedMessages.size > 0) return;


    try {
      set({ loading: true });
      const { data } = await supabase
          .from('message_likes')
          .select('message_id')
          .eq('user_id', user.id);

      if (data) {
        set({ likedMessages: new Set(data.map(like => like.message_id)) });
      }
    } catch (error) {
      console.error('Error fetching likes:', error);
    } finally {
      set({ loading: false });
    }
  },

  toggleLike: async (messageId: number) => {
    const user = useAuthStore.getState().user;
    if (!user) {
      alert('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
      return;
    }

    const { likedMessages } = get();
    const isLiked = likedMessages.has(messageId);

    try {
      // å…ˆæŸ¥è¯¢å½“å‰ç‚¹èµæ•°
      const { data: message, error: queryError } = await supabase
          .from('messages')
          .select('likes_count')
          .eq('id', messageId)
          .single();

      if (queryError) throw queryError;

      const currentLikes = message?.likes_count || 0;

      if (isLiked) {
        // å–æ¶ˆç‚¹èµï¼šåˆ é™¤ç‚¹èµè®°å½•
        const { error: deleteError } = await supabase
            .from('message_likes')
            .delete()
            .eq('message_id', messageId)
            .eq('user_id', user.id);

        if (deleteError) throw deleteError;

        // æ›´æ–° messages è¡¨çš„ç‚¹èµæ•°ï¼ˆå‡1ï¼‰
        const { error: updateError } = await supabase
            .from('messages')
            .update({ likes_count: Math.max(0, currentLikes - 1) })
            .eq('id', messageId);

        if (updateError) throw updateError;

        likedMessages.delete(messageId);
      } else {
        // æ·»åŠ ç‚¹èµï¼šæ’å…¥ç‚¹èµè®°å½•
        const { error: insertError } = await supabase
            .from('message_likes')
            .insert({ message_id: messageId, user_id: user.id });

        if (insertError) throw insertError;

        // æ›´æ–° messages è¡¨çš„ç‚¹èµæ•°ï¼ˆåŠ 1ï¼‰
        const { error: updateError } = await supabase
            .from('messages')
            .update({ likes_count: currentLikes + 1 })
            .eq('id', messageId);

        if (updateError) throw updateError;

        likedMessages.add(messageId);
      }

      set({ likedMessages: new Set(likedMessages) });
    } catch (error) {
      console.error('Error toggling like:', error);
    }
  },
}));

===== src/types/blog.ts =====
export interface Category {
  id: number;
  name: string;
  slug: string;
  description?: string;
  post_count: number;
}

export interface Post {
  id: number;
  title: string;
  slug: string;
  content: string;
  excerpt?: string;
  cover_image?: string;
  category?: Category;
  tags: string[];
  view_count: number;
  like_count: number;
  comment_count: number;
  published_at: string;
  created_at: string;
  author?: {
    name: string;
    avatar?: string;
  };
}

export interface PostComment {
  id: number;
  post_id: number;
  user_id: string;
  content: string;
  likes_count: number;
  created_at: string;
  user?: {
    name: string;
    avatar?: string;
  };
}

===== src/types/index.ts =====
// å®šä¹‰æŠ€èƒ½ä¿¡æ¯
export interface Skill {
  name: string; // æŠ€èƒ½åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹
  level: "Beginner" | "Intermediate" | "Advanced"; // æŠ€èƒ½ç­‰çº§ï¼Œåªèƒ½æ˜¯è¿™ä¸‰ä¸ªå€¼ä¹‹ä¸€
}

// å®šä¹‰é¡¹ç›®ç»å†
export interface Project {
  name: string; // é¡¹ç›®åç§°
  description: string; // é¡¹ç›®æè¿°
  link?: string; // å¯é€‰ï¼Œé¡¹ç›®é“¾æ¥
  category?: string;    // æ–°å¢
  tags?: string[];      // æ–°å¢
}

// å®šä¹‰æ•™è‚²ç»å†
export interface Education {
  school: string; // å­¦æ ¡åç§°
  degree: string; // å­¦ä½
  startYear: number; // å…¥å­¦å¹´ä»½
  endYear: number; // æ¯•ä¸šå¹´ä»½
}

// å®šä¹‰è”ç³»æ–¹å¼
export interface ContactInfo {
  email: string; // å¿…å¡«é‚®ç®±
  phone?: string; // å¯é€‰ç”µè¯
  github?: string; // å¯é€‰ GitHub åœ°å€
  linkedin?: string; // å¯é€‰ LinkedIn åœ°å€
}

// å®šä¹‰ä¸ªäººç®€ä»‹ä¿¡æ¯
export interface AboutInfo {
  bio: string; // ç®€ä»‹æ–‡å­—
  avatar?: string; // å¯é€‰å¤´åƒ URL
}

// æ·»åŠ  Message ç±»å‹
export interface Message {
  id: number;
  name: string;
  content: string;
  created_at: string;
  avatar_url?: string;
  user_id?: string;
  likes_count?: number;
  is_pinned?: boolean; 
}

export interface MessageWithLike extends Message {
  liked_by_user?: boolean;
}

===== tailwind.config.js =====
/** @type {import('tailwindcss').Config} */
export default {
  darkMode: 'class', // âœ… ç¡®ä¿æ˜¯ class æ¨¡å¼
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      colors: {
        // å¯ä»¥åœ¨è¿™é‡Œæ‰©å±•è‡ªå®šä¹‰é¢œè‰²
      },
    },
  },
  plugins: [],
};


===== vite.config.ts =====
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
});

